PORTFOLIO TRACKING DATABASE STRUCTURE
=====================================

┌─────────────────────────────────────────────────────────────────┐
│                        portfolio.db                            │
│                     (SQLite Database)                          │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    portfolio_snapshots                         │
│  ┌─────────┬─────────────┬─────────────┬─────────────┬─────────┐ │
│  │   id    │  timestamp  │ account_id  │total_equity │  cash   │ │
│  ├─────────┼─────────────┼─────────────┼─────────────┼─────────┤ │
│  │invested │unrealized_pnl│realized_pnl │total_pnl   │day_change│ │
│  │capital  │             │             │             │         │ │
│  └─────────┴─────────────┴─────────────┴─────────────┴─────────┘ │
│  Purpose: Daily portfolio snapshots                             │
│  Frequency: Once per day                                        │
└─────────────────────────────────────────────────────────────────┘
                                │
                                │ 1:many
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        positions                               │
│  ┌─────────┬─────────────┬─────────────┬─────────────┬─────────┐ │
│  │   id    │  timestamp  │   symbol    │    side     │quantity │ │
│  ├─────────┼─────────────┼─────────────┼─────────────┼─────────┤ │
│  │avg_entry│current_price│market_value │cost_basis   │unrealized│ │
│  │_price   │             │             │             │_pnl     │ │
│  ├─────────┼─────────────┼─────────────┼─────────────┼─────────┤ │
│  │unrealized│position_size│days_held   │             │         │ │
│  │_pnl_pct │_pct         │            │             │         │ │
│  └─────────┴─────────────┴─────────────┴─────────────┴─────────┘ │
│  Purpose: Individual position tracking                          │
│  Frequency: Every time positions change                        │
└─────────────────────────────────────────────────────────────────┘
                                │
                                │ many:1
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         trades                                 │
│  ┌─────────┬─────────────┬─────────────┬─────────────┬─────────┐ │
│  │   id    │  trade_id   │  timestamp  │   symbol    │ action  │ │
│  ├─────────┼─────────────┼─────────────┼─────────────┼─────────┤ │
│  │quantity │    price    │total_value  │commission   │net_amount│ │
│  ├─────────┼─────────────┼─────────────┼─────────────┼─────────┤ │
│  │ reason  │analysis_conf│             │             │         │ │
│  │         │idence       │             │             │         │ │
│  └─────────┴─────────────┴─────────────┴─────────────┴─────────┘ │
│  Purpose: Record of all buy/sell transactions                   │
│  Frequency: Every trade execution                               │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                   performance_metrics                          │
│  ┌─────────┬─────────────┬─────────────┬─────────────┬─────────┐ │
│  │   id    │  timestamp  │   period    │total_return │total_ret│ │
│  ├─────────┼─────────────┼─────────────┼─────────────┼─────────┤ │
│  │return_pct│sharpe_ratio│max_drawdown │  win_rate   │avg_win  │ │
│  ├─────────┼─────────────┼─────────────┼─────────────┼─────────┤ │
│  │avg_loss │profit_factor│total_trades│winning_trades│losing_  │ │
│  │         │             │             │             │trades   │ │
│  └─────────┴─────────────┴─────────────┴─────────────┴─────────┘ │
│  Purpose: Calculated performance metrics                        │
│  Frequency: Calculated on demand or periodically                │
└─────────────────────────────────────────────────────────────────┘

DATA FLOW DIAGRAM
=================

┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Alpaca    │    │   Market    │    │   Analyst   │
│    API      │    │    Data     │    │   Service   │
└──────┬──────┘    └──────┬──────┘    └──────┬──────┘
       │                  │                  │
       ▼                  ▼                  ▼
┌─────────────────────────────────────────────────────────┐
│                Data Manager                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │Account      │  │Positions    │  │Price        │     │
│  │Status       │  │Data         │  │Data         │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────┘
       │
       ▼
┌─────────────────────────────────────────────────────────┐
│              Portfolio Tracker                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │Save         │  │Calculate    │  │Export       │     │
│  │Snapshots    │  │Metrics      │  │Data         │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────┘
       │
       ▼
┌─────────────────────────────────────────────────────────┐
│                   SQLite Database                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │Portfolio    │  │Positions    │  │Trades       │     │
│  │Snapshots    │  │Table        │  │Table        │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
│  ┌─────────────┐                                       │
│  │Performance  │                                       │
│  │Metrics      │                                       │
│  └─────────────┘                                       │
└─────────────────────────────────────────────────────────┘

SAMPLE DATA EXAMPLES
====================

portfolio_snapshots:
┌────┬─────────────────────┬──────────────────────────────┬─────────────┬─────────┐
│ id │     timestamp       │         account_id           │total_equity │  cash   │
├────┼─────────────────────┼──────────────────────────────┼─────────────┼─────────┤
│ 1  │2025-01-15T16:00:00Z │6be4d920-6015-4900-8506-...  │   99992.09  │99706.03 │
│ 2  │2025-01-16T16:00:00Z │6be4d920-6015-4900-8506-...  │  100150.25  │99500.00 │
└────┴─────────────────────┴──────────────────────────────┴─────────────┴─────────┘

positions:
┌────┬─────────────────────┬────────┬──────┬─────────┬─────────────┬─────────────┐
│ id │     timestamp       │ symbol │ side │quantity │avg_entry_price│current_price│
├────┼─────────────────────┼────────┼──────┼─────────┼─────────────┼─────────────┤
│ 1  │2025-01-15T16:00:00Z │  AAPL  │ LONG │  10.0   │   150.25    │   152.30    │
│ 2  │2025-01-15T16:00:00Z │ BTC/USD│ LONG │   0.1   │  108000.00  │  109500.00  │
└────┴─────────────────────┴────────┴──────┴─────────┴─────────────┴─────────────┘

trades:
┌────┬─────────────────────┬─────────────────────┬────────┬────────┬─────────────┐
│ id │     timestamp       │      trade_id       │ symbol │ action │  quantity   │
├────┼─────────────────────┼─────────────────────┼────────┼────────┼─────────────┤
│ 1  │2025-01-15T14:30:00Z │trade_20250115_001   │  AAPL  │  BUY   │    10.0     │
│ 2  │2025-01-16T10:15:00Z │trade_20250116_001   │ BTC/USD│  BUY   │     0.1     │
└────┴─────────────────────┴─────────────────────┴────────┴────────┴─────────────┘
